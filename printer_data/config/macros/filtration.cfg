[gcode_macro _FILTRATION_VARIABLES]
variable_fan_name: "rattrap" # fill your fan name as defined printer.cfg in section like : [fan_generic nevermore]
gcode:


[gcode_macro TOGGLE_FILTRATION]
description: Toggles air filtration On/Off
gcode:
  {% set SPEED = params.SPEED|default(1.0)|float %}
  
  {% set FAN_NAME = printer["gcode_macro _FILTRATION_VARIABLES"].fan_name %}
  {% set FAN = printer["fan_generic " ~ FAN_NAME] %}

  {% if FAN.speed != 0 %}
    SET_FAN_SPEED FAN={FAN_NAME} SPEED=0
  {% else %}
    SET_FAN_SPEED FAN={FAN_NAME} SPEED={SPEED}
  {% endif %}